<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Cuba admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords"
    content="admin template, Cuba admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="pixelstrap">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
  <title>Cuba - Premium Admin Template</title>
  <!-- Google font-->
  <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i&amp;display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap"
    rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/fontawesome.css">
  <!-- ico-font-->
  <link rel="stylesheet" type="text/css" href="/css/vendors/icofont.css">
  <!-- Themify icon-->
  <link rel="stylesheet" type="text/css" href="/css/vendors/themify.css">
  <!-- Flag icon-->
  <link rel="stylesheet" type="text/css" href="/css/vendors/flag-icon.css">
  <!-- Feather icon-->
  <link rel="stylesheet" type="text/css" href="/css/vendors/feather-icon.css">
  <!-- Plugins css start-->
  <link rel="stylesheet" type="text/css" href="/css/vendors/dropzone.css">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.1.1/min/dropzone.min.css" rel="stylesheet"/> -->
  <!-- Plugins css Ends-->
  <!-- Bootstrap css-->
  <link rel="stylesheet" type="text/css" href="/css/vendors/bootstrap.css">
  <!-- App css-->
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <link rel="stylesheet" type="text/css" href="/css/start-loader.css">
  <link id="color" rel="stylesheet" href="/css/color-1.css" media="screen">
  <!-- Responsive css-->
  <link rel="stylesheet" type="text/css" href="/css/responsive.css">
  <style>
    .topcorner {
      position: absolute;
      top: 0;
      right: 0;
    }
  </style>
</head>

<body>
  <!-- tap on top starts-->
  <div class="loaderposition" style="display:none" id="start-loader">
    <div class="lds-dual-ring"></div>
  </div>
  <div class="tap-top"><i data-feather="chevrons-up"></i></div>
  <!-- tap on tap ends-->
  <!-- page-wrapper Start-->
  <div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start-->
    <div class="page-header">
      <div class="header-wrapper row m-0">
        <!-- <form class="form-inline search-full" action="#" method="get">
            <div class="form-group w-100">
              <div class="Typeahead Typeahead--twitterUsers">
                <div class="u-posRelative">
                  <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text" placeholder="Search Cuba .." name="q" title="" autofocus>
                  <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading...</span></div><i class="close-search" data-feather="x"></i>
                </div>
                <div class="Typeahead-menu"></div>
              </div>
            </div>
          </form> -->
        <div class="header-logo-wrapper">
          <div class="logo-wrapper"><a href="mainmenu.html"><img class="img-fluid" src="/images/logo/pbclogo.png"
                alt=""></a></div>
          <div class="toggle-sidebar"><i class="status_toggle middle sidebar-toggle" data-feather="sliders"></i></div>
        </div>
        <div class="left-header col horizontal-wrapper pl-0">
          <h3>File Manager</h3>
        </div>
        <div class="nav-right col-8 pull-right right-header p-0">
          <ul class="nav-menus">
            <li class="profile-nav onhover-dropdown p-0 mr-0">
              <div class="media profile-media"><img class="b-r-10" src="/images/dashboard/profile.jpg" alt="">
                <div class="media-body" id="text_user"><span>User</span> <i class="middle fa fa-angle-down"></i>
                  <p class="mb-0 font-roboto"><span>Admin</span></p>
                </div>
              </div>
              <ul class="profile-dropdown onhover-show-div">
                <!-- <li><a href="#" id="link_account"><i data-feather="user"></i><span>Account </span></a></li> -->
                <li><a href="#" id="link_logout"><i data-feather="log-in"> </i><span>Log out</span></a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Page Header Ends                              -->
    <!-- Page Body Start-->
    <div class="page-body-wrapper sidebar-icon">
      <!-- Page Sidebar Start-->
      <div class="sidebar-wrapper">
        <div class="logo-wrapper"><img class="img-fluid for-light" id='img_mainmenu' src="/images/logo/mainlogo.png"
            alt="" width="120">
          <div class="back-btn"><i class="fa fa-angle-left"></i></div>
          <div class="toggle-sidebar"><i class="status_toggle middle sidebar-toggle" data-feather="grid"> </i></div>
        </div>
        <div class="logo-icon-wrapper"><img class="img-fluid" id='img_mainmenu' src="/images/logo/mainlogo-icon.png"
            alt="" width="30"></div>
        <nav class="sidebar-main">
          <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
          <div id="sidebar-menu">
            <ul class="sidebar-links custom-scrollbar" >
              <li class="back-btn"><a href="index.html"><img class="img-fluid" src="/images/logo/logo-icon.png"
                    alt=""></a>
                <div class="mobile-back text-right"><span>Back</span><i class="fa fa-angle-right pl-2"
                    aria-hidden="true"></i></div>
              </li>
              <li class="sidebar-list"><a class="sidebar-link sidebar-title" href="#"><i
                    data-feather="database"></i><span>Import</span></a>
                <ul class="sidebar-submenu" id="ul">
                  <li><a href="#" id="link_importmenu">Import Master File</a></li>
                </ul>
              </li>
              <li class="sidebar-list"><a class="sidebar-link sidebar-title" href="#"><i
                    data-feather="upload"></i><span>File Manger</span></a>
                <ul class="sidebar-submenu" id="ul">
                  <li><a href="#" id="link_upload_files">Upload Files</a></li>
                </ul>
              </li>
              <li class="sidebar-list"><a id="ko" class="sidebar-link sidebar-title" href="#"><i
                    data-feather="trello"></i><span>Reports</span></a>
                <ul class="sidebar-submenu" id="ul">
                  <li><a href="#" id="link_summery_report">Generate Report</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
        </nav>
      </div>
      <!-- Page Sidebar Ends-->
      <div class="page-body">
        <div class="container-fluid">
          <div class="page-title">
            <div class="row">
              <div class="col-6">
                <!-- <h3>File Manager</h3> -->
              </div>
              <!-- <div class="col-6">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">                                       <i data-feather="home"></i></a></li>
                    <li class="breadcrumb-item">Apps</li>
                    <li class="breadcrumb-item active"> File Manager</li>
                  </ol>
                </div> -->
            </div>
          </div>
        </div>
        <!-- Container-fluid starts-->
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-12">
              <div class="card">
                <div class="card-body">
                  <h4 class="mb-3">Upload Files</h4>
                  <form class="dropzone" action="/upload_multiple_files" id="upload-widget"
                    enctype="multipart/form-data" method="post">
                    <div class="dz-message needsclick"><i class="icon-cloud-up"></i>
                      <h6>Drop files here or click to upload.</h6><span class="note needsclick">(Only
                        <strong>CSV</strong> file type is allowed.)</span>
                    </div>
                  </form>
                  <br />
                  <input class="btn btn-success" id="btn-upload-files" value="Upload" type="submit" />
                  <input class="btn btn-secondary" id="btn-clear-files" value="Clear" type="submit" />
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="file-content">
                <div class="card">
                  <div class="card-body file-manager">
                    <h4 class="mb-3">All Files</h4>
                    <ul class="files" id="ul_filelist">
                      <!-- <li class="file-box">
                          <div class="file-top">  <i class="fa fa-file-archive-o txt-secondary"></i><i class="fa fa-ellipsis-v f-14 ellips"></i></div>
                          <div class="file-bottom">
                            <h6>Project.zip </h6>
                            <p class="mb-1">1.90 GB</p>
                          </div>
                        </li> -->
                      <!-- <li class="file-box">
                        <div class="file-top"> <i class="fa fa-file-excel-o txt-success"></i>
                          <div>
                            <a href='#' title='delete' class="itemDelete"><i class="fa fa-times f-20 ellips"
                                style="color: red;"></i></a>
                          </div>
                        </div>
                        <div class="file-bottom">
                          <h6>Backend.xls</h6>
                          <p class="mb-1">2.00 GB</p>
                        </div>
                      </li> -->
                      <!-- <li class="file-box">
                          <div class="file-top">  <i class="fa fa-file-text-o txt-info"></i><i class="fa fa-ellipsis-v f-14 ellips"></i></div>
                          <div class="file-bottom">
                            <h6>requirements.txt </h6>
                            <p class="mb-1">0.90 KB</p>
                          </div>
                        </li> -->
                      <!-- <li class="file-box">
                          <div class="file-top">  <i class="fa fa-file-text-o txt-primary"></i><i class="fa fa-ellipsis-v f-14 ellips"></i></div>
                          <div class="file-bottom">
                            <h6>Logo.psd </h6>
                            <p class="mb-1">2.0 MB</p>
                          </div>
                        </li>                       -->
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Container-fluid Ends-->
      <!-- footer start-->
      <footer class="footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12 footer-copyright text-center">
              <p class="mb-0">Copyright 2022 Â© Stock Count Cloud Solution by Planet Barcode</p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>
  <!-- latest jquery-->
  <script src="/js/jquery-3.5.1.min.js"></script>
  <!-- Bootstrap js-->
  <script src="/js/bootstrap/popper.min.js"></script>
  <script src="/js/bootstrap/bootstrap.js"></script>
  <!-- feather icon js-->
  <script src="/js/icons/feather-icon/feather.min.js"></script>
  <script src="/js/icons/feather-icon/feather-icon.js"></script>
  <!-- Sidebar jquery-->
  <script src="/js/config.js"></script>
  <!-- Plugins JS start-->
  <script src="/js/sidebar-menu.js"></script>
  <script src="/js/icons/feather-icon/feather-icon-clipart.js"></script>
  <!-- <script src="/js/typeahead/handlebars.js"></script> -->
  <!-- <script src="/js/typeahead/typeahead.bundle.js"></script> -->
  <!-- <script src="/js/typeahead/typeahead.custom.js"></script> -->
  <!-- <script src="/js/typeahead-search/handlebars.js"></script> -->
  <!-- <script src="/js/typeahead-search/typeahead-custom.js"></script> -->
  <script src="/js/dropzone/dropzone.js"></script>
  <script src="/js/dropzone/dropzone-script.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="/js/tooltip-init.js"></script>
  <!-- Plugins JS Ends-->
  <!-- Theme js-->
  <script src="/js/script.js"></script>
  <!-- <script src="/js/theme-customizer/customizer.js"></script> -->
  <!-- login js-->
  <!-- Plugin used-->

  <script>
    $.ajax({
      url: "/get_files",
      method: "GET",
      success: function (data) {
        console.log(data)
        var items = [];
        $.each(data, function (i, item) {
          console.log(data[0].fname)
          items.push('<li class="file-box">' +
            '<div class="file-top">  <i class="fa fa-file-text-o txt-primary"></i>' +
            '<div>' +
            '<a href="#" title="delete" class="itemDelete"><i class="fa fa-times f-20 ellips" style="color: red;"></i></a>' +
            '</div >' +
            // '<div>' +
            // '<a href="#" title="download" class="itemDownload"><i class="fa fa-cloud-download f-20 ellips1" style="color: green;"></i></a>' +
            // '</div >' +
            '</div>' +
            '<div class="file-bottom">' +
            '<h6 id="filename_id"> ' + data[i].fname + ' </h6>' +
            '<p class="mb-1">' + data[i].fsize + '</p>' +
            '<p> <b>created at : </b>' + data[i].ftime + '</p>' +
            '</div>' +
            '</li>')

        });

        $('#ul_filelist').append(items.join(''));


      },
      error: function (e) {
        console.log("some error", e);
        $("#start-loader").hide();
        // alert("Cannot Read Files");
      }
    })

    console.log($(window).width())

    $('#ul_filelist').on('click', '.itemDelete', function () {
      console.log($(this).closest('li').find('#filename_id').text())
      var filenamedata = { filename: $(this).closest('li').find('#filename_id').text() }
      var ulfilelist = $(this)
      Swal.fire({
        title: 'Do you want to delete this file?',
        showCancelButton: true,
        confirmButtonText: 'DELETE',
      }).then((result) => {
        /* Read more about isConfirmed, isDenied below */
        if (result.isConfirmed) {
          $.ajax({
            url: "/deletefile",
            method: "POST",
            data: filenamedata,
            success: function (data) {
              Swal.fire('File Deleted!', '', 'success');
              ulfilelist.closest('li').remove();
            },
            error: function (e) {
              // alert("Cannot Delete File");
              Swal.fire('Cannot Delete FIle', '', 'info')
            }
          })
        }
      })
    });

    $('#ul_filelist').on('click', '.itemDownload', function () {
      console.log($(this).closest('li').find('#filename_id').text())
      var filenamedata = $(this).closest('li').find('#filename_id').text()
      var ulfilelist = $(this)
      $.ajax({
            url: "/downloadfile",
            method: "GET",
            headers: { 
                       'filename': filenamedata },
            success: function (data) {
              Swal.fire('File Downloaded!', '', 'success');
            },
            error: function (e) {
              Swal.fire('Cannot Download FIle', '', 'info')
            }
          })
    });

  </script>
</body>

</html>